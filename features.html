<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Game</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>
<body>
    <h1>Web Game</h1>
    <div id="auth-section">
        <h2>Sign In / Sign Up</h2>
        <input type="email" id="email" placeholder="Enter email">
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="signUp()">Sign Up</button>
        <button onclick="signIn()">Sign In</button>
        <button onclick="signOut()">Sign Out</button>
    </div>

    <div id="game-section" style="display: none;">
        <h2>Game</h2>
        <p>Level: <span id="level">1</span></p>
        <p>Score: <span id="score">0</span></p>
        <p>Stones: <span id="stones">0</span></p>
        <p>Stone Pieces: <span id="stonePieces">0</span></p>
        <button onclick="increaseScore()">Increase Score</button>
        <button onclick="levelUp()">Level Up</button>
        <button onclick="saveProgress()">Save Progress</button>
        <button onclick="loadProgress()">Load Progress</button>
        <h2>Leaderboard</h2>
        <ul id="leaderboard"></ul>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let userProgress = { level: 1, score: 0, stones: 0, stonePieces: 0 };

        function signUp() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(() => alert("User signed up!"))
                .catch(error => alert("Error: " + error.message));
        }

        function signIn() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            auth.signInWithEmailAndPassword(email, password)
                .then(() => {
                    alert("Signed in!");
                    document.getElementById("auth-section").style.display = 'none';
                    document.getElementById("game-section").style.display = 'block';
                    loadProgress();
                })
                .catch(error => alert("Error: " + error.message));
        }

        function signOut() {
            auth.signOut().then(() => {
                alert("Signed out!");
                document.getElementById("auth-section").style.display = 'block';
                document.getElementById("game-section").style.display = 'none';
            });
        }

        function increaseScore() {
            userProgress.score += 10;
            document.getElementById("score").innerText = userProgress.score;
            
            if (Math.random() < 0.5) { // 50% drop rate for skills
                userProgress.stonePieces += 1;
                document.getElementById("stonePieces").innerText = userProgress.stonePieces;
            }
            
            if (userProgress.stonePieces >= 100) {
                userProgress.stones += 1;
                userProgress.stonePieces -= 100;
                document.getElementById("stones").innerText = userProgress.stones;
                document.getElementById("stonePieces").innerText = userProgress.stonePieces;
            }
        }

        function levelUp() {
            userProgress.level += 1;
            document.getElementById("level").innerText = userProgress.level;
        }

        function saveProgress() {
            const user = auth.currentUser;
            if (!user) return alert("Sign in first!");
            db.collection("gameProgress").doc(user.uid).set(userProgress)
                .then(() => alert("Progress saved!"))
                .catch(error => alert("Error: " + error.message));
        }

        function loadProgress() {
            const user = auth.currentUser;
            if (!user) return;
            db.collection("gameProgress").doc(user.uid).get()
                .then(doc => {
                    if (doc.exists) {
                        userProgress = doc.data();
                        document.getElementById("level").innerText = userProgress.level;
                        document.getElementById("score").innerText = userProgress.score;
                        document.getElementById("stones").innerText = userProgress.stones;
                        document.getElementById("stonePieces").innerText = userProgress.stonePieces;
                    }
                });
        }

        function loadLeaderboard() {
            db.collection("leaderboard").orderBy("score", "desc").limit(10).get()
                .then(querySnapshot => {
                    const leaderboard = document.getElementById("leaderboard");
                    leaderboard.innerHTML = "";
                    querySnapshot.forEach(doc => {
                        const data = doc.data();
                        const li = document.createElement("li");
                        li.textContent = `${data.email} - Score: ${data.score}`;
                        leaderboard.appendChild(li);
                    });
                });
        }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById("auth-section").style.display = 'none';
                document.getElementById("game-section").style.display = 'block';
                loadProgress();
                loadLeaderboard();
            } else {
                document.getElementById("auth-section").style.display = 'block';
                document.getElementById("game-section").style.display = 'none';
            }
        });
    </script>
</body>
</html>
